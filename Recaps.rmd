---
title: "This Isn't Top Scallops, 2020 Edition!"
date: "Last Updated: `r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    theme: cosmo
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = TRUE)

setwd(here::here())
options(scipen=999)

library(knitr)
library(kableExtra)
library(emo)
library(png)
library(rlang)
library(tidyverse)
```

```{css, echo = FALSE}
.emoji {
  font-size: 325%;
  vertical-align: middle;
}

.shrug {
  font-size: 400%;
  vertical-align: middle;
}
```

```{r}
contestants <- c("Eric Adjepong",
                 "Karen Akunowicz",
                 "Jennifer Carroll",
                 "Stephanie Cmar",
                 "Lisa Fernandes",
                 "Kevin Gillespie",
                 "Gregory Gourdet",
                 "Melissa King",
                 "Jamie Lynch",
                 "Brian Malarkey",
                 "Nini Nguyen",
                 "Joe Sasto",
                 "Angelo Sosa",
                 "Bryan Voltaggio",
                 "Lee Anne Wong")

preds_long <- read_csv("This Isn't Top Scallops - 2020 - Draft.csv") %>% 
  .[1:15,] %>% 
  dplyr::select(-1) %>% 
  mutate('Predicted \nFinish' = as.numeric(case_when(.$`Predicted \nFinish` == "1st place" ~ "1",
                                          .$`Predicted \nFinish` == "Last place" ~ "15",
                                          TRUE ~ .$`Predicted \nFinish`))) %>% 
  rename_at(.vars = vars(contains(" \n")),
            .funs = funs(sub(" \n", " ", .))) %>% 
  rename_at(.vars = vars(contains("\n")),
            .funs = funs(sub("\n", " ", .))) %>% 
  gather(key = "Team",
         value = "Cheftestant",
         2:25) %>% 
  group_by(Team) %>% 
  mutate("Predicted Finish" = row_number()) %>% 
  ungroup() %>% 
  mutate(Members = str_extract(Team,
                               '\\([^\\(]*$') %>% 
           str_remove_all(., "\\(|\\)"),
         Members = ifelse(is.na(Members), "Jackson Fratesi", Members),
         Team = str_remove_all(Team,
                               " \\([^\\(]*$")) %>% 
  dplyr::select(Team, Members, "Predicted Finish", Cheftestant)

preds_wide <- preds_long %>% 
  spread(key = "Predicted Finish",
         value = Cheftestant) %>% 
  rename("First Place" = "1",
         "Last Place" = "15")

pics <- list.files(path = "Pics",
                   full.names = TRUE,
                   pattern="*.png")

angelo <- pics[1]
brian <- pics[2]
bryan <- pics[3]
eric <- pics[4]
gregory <- pics[5]
jamie <- pics[6]
jen <- pics[7]
joe <- pics[8]
karen <- pics[9]
kevin <- pics[10]
lee_anne <- pics[11]
lisa <- pics[12]
melissa <- pics[13]
nini <- pics[14]
stephanie <- pics[15]

headshotsize <- 200
dishsize <- "600px"

eliminated <- c()
```

Welcome to This Isn't Top Scallops, a Top Chef fantasy league! This page will be home to the league's rules, draft summary, episode-by-episode recaps, _advanced_ metrics, and assorted memes.

# Rules

**Scoring:** The goal of the season is to have the highest Final Score.  2nd place gets \$15, and the winner gets \$105 (24 total players!).  Your score will have two parts, each weighted equally:

* **Ranking Score:** This is how closely your predictions match up with the final finishes. If you guess every chef's finish from 1-to-16 correctly, you would have a perfect score.
    - Note that chefs eliminated early in the season may get back onto the show via Last Chance Kitchen! In that case, we will use the chef's final position after the season has ended.

* **Episode Score:** You'll score points for every chef in your **top 8** (MySpace, baby) that ends up on top in the quickfire or elimination challenge.
    - Points Awarded = 
        - Quickfire Winner: 
        $\scriptsize (10 - ChefRank) * 2$
        - Elimination Challenge Winner: 
        $\scriptsize (15 - ChefRank) * 2$
        - Quickfire or Elimination Challenge Honorable Mentions: 
        $\scriptsize 10 - ChefRank$
      
   - *Honorable Mentions: being in the Top 3, being on the winning team for team challenges, or getting a special shout out from the judges.
   - Chefs eliminated during an episode can still earn points from winning a quickfire that episode.
   - If there is no one winner specified in a team challenge, everyone receives honorable mention points.
        

    - Example:  I rank Eric as 2nd overall and Jenn as 3rd overall.  Eric wins the quickfire and Jenn is on top in the elimination challenge.  I get 9 points from Eric (11 - 2) and 12 points from Jenn ((9 - 3) * 2).

At the end, we'll scale everyone's points (see below) for the two scores.  Your final score will be the average of the two. 

* **Final Score:**
  - Scaled Final Finish Score = 
  $$\scriptsize 1 - \frac{YourRankingScore - min(AllRankingScores)}{max(AllRankingScores) - min(AllRankingScores)}$$
  - Scaled Episode Score = 
  $$\scriptsize \frac{YourEpisodeScore - min(AllEpisodeScores)}{max(AllEpisodeScores) - max(AllEpisodeScores)}$$
  - **Final Score** = 
  $$\scriptsize \frac{Scaled Ranking Score + Scaled Episode Score}{2}$$

# Week 1 Recap

```{r, Week 1 Summary}
eliminated <- c(eliminated, "Joe Sasto")

QFwinner <- c()
QFHM <- c("Melissa King", "Joe Sasto", "Jamie Lynch", "Kevin Gillespie", "Bryan Voltaggio")
EMwinner <- c("Gregory Gourdet")
EMHM <- c("Melissa King", "Jennifer Carroll", "Stephanie Cmar", "Jamie Lynch")
```

It's great to be back! This was a very exciting first episode that saw the all-stars compete in a mise en place relay Quickfire outside Griffith Observatory and a fire-only Elimination Challenge on the beach. Some of the contestants came out of the gate running (Gregory, Melissa), while others looked rusty in their first challenges back (Lee Anne, Brian).

Special shout-out to Bryan Voltaggio's elimination challenge dish, which takes the "I guess you should to taste it IRL because it really looks terrible and that's the fundamental flaw with cooking shows" prize of the week.

```{r, out.width = dishsize}
include_graphics("https://i.imgur.com/QDqQI6L.png")
```

Here is this week's recap of winners, losers, and our standings so far.

### Quickfire

The red team won with two dishes: a delicious char-grilled artichoke with tahini and a chewy-but-tasty-looking artichoke tortellono. 

**Winner:** No one winner was announced.

[`r ji("fire")`]{.emoji} [`r ji("trophy")`]{.emoji}

[`r ji("person_shrugging_medium_light_skin_tone")`]{.shrug}

**Honorable Mentions:** Melissa, Joe, Jamie, Kevin, and Bryan

[`r ji("fire")`]{.emoji} [`r ji("2nd_place_medal")`]{.emoji}

`r include_graphics(c(melissa, joe, jamie, kevin, bryan), dpi = headshotsize)`

**Winning Dishes**

```{r, out.width = dishsize}
include_graphics("https://i.imgur.com/obWcFmP.png")

include_graphics("https://i.imgur.com/Kvgec6j.png")
```

### Elimination Challenge

**Winner:** Gregory!

[`r ji("chef")`]{.emoji} [`r ji("trophy")`]{.emoji}

`r include_graphics(c(gregory), dpi = headshotsize)`

**Honorable Mentions:** Stephanie and Jamie on the winning team. Melissa and Jen also got special shout-outs from the judges.

[`r ji("chef")`]{.emoji} [`r ji("2nd_place_medal")`]{.emoji}

`r include_graphics(c(stephanie, jamie, melissa, jen), dpi = headshotsize)`

**Eliminated:**

[`r ji("skull_and_crossbones")`]{.emoji}

`r include_graphics(c(joe), dpi = headshotsize)`

**Winning Dishes**

```{r, out.width = dishsize}
include_graphics("https://i.imgur.com/BacCbVa.png")
```

```{r, out.width = dishsize}
include_graphics("https://i.imgur.com/m35QsR9.png")
```

```{r, out.width = dishsize}
include_graphics("https://i.imgur.com/BatQziR.png")
```

**Losing Dish**

```{r, out.width = dishsize}
include_graphics("https://i.imgur.com/6WNSQsK.png")
```

### Episode Score

```{r}
week <- 1
week_point_title <- paste("Week", week, "Points") 
week_winners <- list(QFwinner = QFwinner, 
                     QFHM = QFHM, 
                     EMwinner = EMwinner, 
                     EMHM = EMHM)

find_weekly_episode_score <- function(){
  
  preds_long %>% 
  mutate("Week Points" = case_when(Cheftestant %in% week_winners$QFwinner & 
                                       .$`Predicted Finish` <= 8 ~ (10 - .$`Predicted Finish`) * 2,
                                     Cheftestant %in% week_winners$EMwinner & 
                                       .$`Predicted Finish` <= 8 ~ (15 - .$`Predicted Finish`) * 2,
                                     Cheftestant %in% c(week_winners$QFHM, week_winners$EMHM) & 
                                       .$`Predicted Finish` <= 8 ~ 10 - .$`Predicted Finish`,
                                     TRUE ~ 0)) %>% 
  dplyr::group_by(Team, Members) %>% 
  dplyr::summarise(!!week_point_title := sum(`Week Points`)) %>%
  ungroup()
  
}

weekly_episode_score <- find_weekly_episode_score() %>% 
  mutate("Total Points" = `Week 1 Points`) %>% 
  arrange(desc(`Total Points`)) 

```

The top 3 scorers in points for this episode are **`r arrange(weekly_episode_score, desc(weekly_episode_score$"Week 1 Points")) %>% slice(1) %>% pull(Team)`**, **`r arrange(weekly_episode_score, desc(weekly_episode_score$"Week 1 Points")) %>% slice(2) %>% pull(Team)`**, and **`r arrange(weekly_episode_score, desc(weekly_episode_score$"Week 1 Points")) %>% slice(3) %>% pull(Team)`**.

Here are the overall standings in Episode Score after the first episode.

```{r, fig.height = 6}
ggplot(weekly_episode_score,
       aes(x = reorder(Team, weekly_episode_score$"Total Points"),
           y = weekly_episode_score$`Total Points`)) +
  geom_bar(stat = "identity",
           position = "dodge",
           aes(fill = Team)) +
  scale_fill_discrete(guide = FALSE) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  coord_flip() +
  theme_bw() +
  labs(x = "Team",
       y = "Total Episode Points",
       title = paste("Overall Episode Score Standings After Week", week),
       subtitle = "A higher score is better!")
```

### Ranking Score

We won't know the final Ranking Scores until the season is over, but we can get a sense of how people are doing based on where they ranked contestants that have already been eliminated (notwithstanding possible Last Chance Kitchen comebacks).

Incredibly, Elsa, who has never seen Top Chef, but admittedly loves gambling, is the only one to have guessed this week's loser. She leads in this category.

`r include_graphics("Misc/Elsa_text.jpeg", dpi = headshotsize)`

Here's where things stand currently.

```{r, fig.height = 6}
Final_points_lost <- preds_long %>% 
  mutate("Final Ranking Points Lost" = ifelse(Cheftestant %in% eliminated,
                                              abs(16 - match(Cheftestant, eliminated) - `Predicted Finish`),
                                              0)) %>% 
  group_by(Team, Members) %>% 
  dplyr::summarise("Final Ranking Points Lost"= sum(`Final Ranking Points Lost`)) %>%
  ungroup()

ggplot(Final_points_lost,
       aes(x = reorder(Team, -Final_points_lost$"Final Ranking Points Lost"),
           y = Final_points_lost$`Final Ranking Points Lost`)) +
  geom_bar(stat = "identity",
           position = "dodge",
           aes(fill = Team)) +
  scale_fill_discrete(guide = FALSE) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  coord_flip() +
  theme_bw() +
  labs(x = "Team",
       y = "Total Points",
       title = paste("Total Final Ranking Points Lost as of Week", week),
       subtitle = "A lower number is better!")
```

Lastly, here's a look at how everyone's team is doing after Week 1.

```{r}
preds_wide %>% 
  mutate_if(is.character,
            function(x) {
              cell_spec(x,
                        format = "html",
                        color = ifelse(x %in% eliminated, "red", ""),
                        strikeout = ifelse(x %in% eliminated, TRUE, FALSE))
            }) %>% 
  kable(format = "html", escape = FALSE) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "responsive"),
                font_size = 12,
                fixed_thead = TRUE,) %>% 
  column_spec(1, bold = TRUE, 
              width = "10em; display: inline-block;") %>% 
  column_spec(2, border_right = TRUE, width = "20em") %>% 
  scroll_box(width = "100%",
             height = "700px")

```




```{r, eval = FALSE}
### USE THIS FOR WEEK 2 EPISODE SCORE

week <- 2
week_point_title <- paste("Week", week, "Points") 
week_winners <- list(QFwinner = QFwinner, 
                     QFHM = QFHM, 
                     EMwinner = EMwinner, 
                     EMHM = EMHM)

weekly_episode_score <- left_join(weekly_episode_score %>% 
                                    dplyr::select(-"Total Points"),
                                  find_weekly_episode_score(),
                                  by = c("Team", "Members")) %>% 
  mutate("Total Points" = rowSums(.[grep("Points", names(.))], na.rm = TRUE)) %>% 
  arrange(desc(`Total Points`))
```



